window.REBASE=window.REBASE||{},REBASE.theme=REBASE.theme||{},function($){$((function(){var mmStatus="closed";function closeMM(){mmStatus="closed",$("#mobile-navigation-toggle").removeClass("opened"),$("body").removeClass("nav-opened")}function openMM(){mmStatus="opened",_body=$("body"),_body.removeClass("search-opened"),_body.addClass("nav-opened"),$("#mobile-navigation-toggle").addClass("opened"),_body.hasClass("mini-cart-open")&&$(".minicart-toggle-btn").trigger("click")}function getCookie(name){return(document.cookie.match("(^|; )"+name+"=([^;]*)")||0)[2]}function findCurrentVariant(variantId){return meta.product.variants.filter((function(item){return item.id.toString()===variantId}))[0]}function shouldShowUpgradeModal(variantId){var currentVariant;return findCurrentVariant(variantId).name.split(" / ").includes("12 Bags")&&$(".rc_block__type__onetime").hasClass("rc_block__type--active")}function shouldAddFreeGift(){if("undefined"==typeof promoProduct)return!1;var free_gift_item=CartJS.cart.items.filter((function(item){return item.sku===promoProduct.variants[0].sku}));return $(".product-option-row--free-gift input").is(":checked")&&0===free_gift_item.length}function shouldAddThresholdGift(variantId){var thresholdGiftCookieName;if("undefined"==typeof promoEnabled||"undefined"==typeof promoAmount||!getCookie("sys_recharge_freegift_gauge"))return!1;var product=meta.product.variants.filter((function(item){return item.id.toString()===variantId}))[0];return promoEnabled&&CartJS.cart.total_price+product.price>=promoAmount&&"onetime"==$(".rc_radio:checked").val()}function addThresholdGift(){if("undefined"!=typeof promoProduct){var cartDoesNotHaveUpsellGift=0==CartJS.cart.items.filter((function(item){return item.id==promoProduct.variants[0].id})).length,cartHasNoSubscriptions=0==CartJS.cart.items.filter((function(item){return item.properties.hasOwnProperty("subscription_id")})).length;cartDoesNotHaveUpsellGift&&cartHasNoSubscriptions&&CartJS.addItem(promoProduct.variants[0].id,1,{},{success:function(data,textStatus,jqXHR){console.log("Added!")},error:function(jqXHR,textStatus,errorThrown){console.log("Error: "+errorThrown+"!")}})}}function showUpgradeModal(variantId){var modalHTML='<div id="12bag-upgrade-modal" class="modal" data-variant-id="'+variantId+'"><h1>Upgrade to 24 Bags and Save 20%</h1><p>82% of customers have taken advantage of this deal.</p><a href="#" class="btn btn--block" id="modal-upgrade-button">Upgrade!</a><a class="btn btn--block" href="#" id="modal-close-button" rel="modal:close">No Thanks</a><a class="" href="#" id="modal-close-button-x" rel="modal:close">Ã—</a></div>';0===$("body #12bag-upgrade-modal").length?$("body").append(modalHTML):$("body #12bag-upgrade-modal").replaceWith(modalHTML),$("#12bag-upgrade-modal").on($.modal.BEFORE_OPEN,(function(event,modal){$(".modal-wrapper").show(),$("#12bag-upgrade-modal").addClass("grid")})),$("#12bag-upgrade-modal").modal({blockerClass:"upgrade-modal modal-wrapper",escapeClose:!1,clickClose:!1,showClose:!1}),$("#12bag-upgrade-modal #modal-upgrade-button").on("click",(function(){var variantId=$("#12bag-upgrade-modal").data("variant-id"),currentVariant,currentVariantNameItems=meta.product.variants.filter((function(item){return item.id===variantId}))[0].name.split("/");currentVariantNameItems.pop();var upgradedVariant=meta.product.variants.filter((function(item){return item.name.includes(currentVariantNameItems.join("/").replace("12 Bags","24 Bags"))}))[0];CartJS.removeItemById(variantId),CartJS.addItem(upgradedVariant.id,1,{},{success:function(data,textStatus,jqXHR){console.log("Added!")},error:function(jqXHR,textStatus,errorThrown){console.log("Error: "+errorThrown+"!")}}),$.modal.close()}))}$("#mobile-navigation-toggle, .mobile-navigation-close").on("click",(function(){return"closed"==mmStatus?openMM():"opened"==mmStatus&&closeMM(),!1})),$(".mobile-navigation-item__toggle").on("click",(function(e){e.preventDefault(),$(this).closest("li").toggleClass("open")})),$(document).on("click",".mobile-navigation-header-item",(function(e){var _this=$(this);$(".mobile-navigation-header-item").removeClass("mobile-navigation-header-item--selected"),_this.addClass("mobile-navigation-header-item--selected"),$(".mobile-navigation-item").removeClass("mobile-navigation-item--selected"),$(".mobile-navigation-item--"+_this.data("link-handle")).addClass("mobile-navigation-item--selected")})),$(document).on("touchstart",".minicart.minicart--visible",(function(e){touchstartX=e.changedTouches[0].screenX})),$(document).on("touchend",".minicart.minicart--visible",(function(e){touchendX=event.changedTouches[0].screenX,touchendX-touchstartX>100&&$(".minicart__header span").trigger("click")})),$(document).on("click","#add-to-cart",(function(){var urlParams,variantId=new URLSearchParams(window.location.search).get("variant");shouldShowUpgradeModal(variantId)&&showUpgradeModal(variantId),!shouldAddFreeGift()&&shouldAddThresholdGift(variantId)&&(console.log("threshold gift"),addThresholdGift()),shouldAddFreeGift()&&(console.log("adding gift with id "+promoProduct.variants[0].id),CartJS.addItem(promoProduct.variants[0].id,1,{free_gift:!0},{success:function(data,textStatus,jqXHR){console.log("Added!")},error:function(jqXHR,textStatus,errorThrown){console.log("Error: "+errorThrown+"!")}}))})),$("#forgot-password").on("click",(function(){$("#recover-password-form").show(),$("#customer-login-form").hide()})),$("#forgot-password-cancel").on("click",(function(){$("#recover-password-form").hide(),$("#customer-login-form").show()}))}))}(jQuery);

// Update announcement bar text with discount code and countdown timer
if (window.location.href.includes("utm_content")) {
  var str = window.location.href;
  var campaignValue = str.split('utm_content=').pop();
  var arr = campaignValue.split("&");
  var discountCodeValue = arr[0];
  localStorage.setItem("utmDiscountCode", discountCodeValue);
  var discountCode = localStorage.getItem("utmDiscountCode");

  function getCookie(cname) {
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for(var i = 0; i <ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }

  // var discountCode = getCookie("discount_code");


  // document.cookie = `discount_code=${discountCode}`;
}

if (localStorage.getItem("utmDiscountCode")) {
  const announcementBarText = $(".header-promo p").text();
  $(".header-promo p").html(`Order in the next <span id="timer"></span> ðŸ‘‰ use code <strong class="discountCode">${localStorage.getItem("utmDiscountCode")}</strong> for 10% off. <br /> Free Shipping + 30 Day Money Back Guarantee.`);

  var interval = 30 * 60 * 1000;

  var rechargeCheckoutLink = '';

  $(document).ready(function() {
    function updateCheckoutLink() {
      rechargeCheckoutLink = $(".cart-drawer__action .js-cart-checkout-recharge-btn").attr('href');
      var remove_after= rechargeCheckoutLink.indexOf('&flashSale=');
      var rechargeCheckoutLinkWithoutSales =  rechargeCheckoutLink.substring(0, remove_after);
      $(".cart-drawer__action .js-cart-checkout-recharge-btn").hide();
      $(".cart-drawer__action").append("<a href='' class='btn btn--second btn--block'>Secure Checkout</a>");
      $(".btn--second").attr('href', `${rechargeCheckoutLinkWithoutSales.replace("&flashSale=", "")}&discount=${localStorage.getItem("utmDiscountCode")}`);
    }

    updateCheckoutLink();
  });

  function reset() {
    localStorage.endTime = +new Date + interval;
  }
  
  if( ! localStorage.endTime ) {
    reset();
  }
  
  setInterval( function() {
    var remaining = localStorage.endTime - new Date;
    var min = Math.floor(remaining / (60 * 1000));
    var sec = Math.floor((remaining - (min * 60 * 1000)) / 1000);
    if( remaining >= 0 ) {
      if (sec >= 0 && sec < 10) {
        sec = '0' + sec
      }
      $('#timer').text(min + ":" + sec);
    } else {
      $(".header-promo p").html(announcementBarText);
      reset();
    }
  }, 100 );

  // function delete_cookie( name, path, domain ) {
  //   if( get_cookie( name ) ) {
  //     document.cookie = name + "=" +
  //       ((path) ? ";path="+path:"")+
  //       ((domain)?";domain="+domain:"") +
  //       ";expires=Thu, 01 Jan 1970 00:00:01 GMT";
  //   }
  // }
  // delete_cookie( session )
}


const drawerCartTitle = $(".cart-drawer__title").text();
var timeEnded = false;

function updateCart(key) {
  var interval = 9.970 * 60 * 1000;

  function reset() {
    localStorage[key] = +new Date + interval;
  }
  
  if( ! localStorage[key] ) {
    reset();
  }  

  setInterval( function() {
    var remaining = localStorage[key] - new Date;
    var min = Math.floor(remaining / (60 * 1000));
    var sec = Math.floor((remaining - (min * 60 * 1000)) / 1000);
    if( remaining >= 0 ) {
      $('#cartTimer').text(min + ":" + sec);
    } else {
      if (timeEnded === false) {
        updateText();
        $(".cart-drawer__title").css("font-size", "20px");
        timeEnded = true;
      }
    }
  }, 100 );

  function updateText() {
    $(".cart-drawer__title").html(drawerCartTitle);
  }
}

function updateCartTitle(text) {
  $(".cart-drawer__title").html(text);
}

for (let i = 1; i <= 4; i++) {
  // Update cart text with timer
  if (window.location.href.includes("?ct" + i)) {
    for (let j = 1; j <= 4; j++) {
      localStorage.removeItem('updateCart' + j);
    }
    localStorage.setItem("updateCart" + i, true);
  }

  if (localStorage.getItem("updateCart" + i)) {
    if (timeEnded === false) {
      $(".cart-drawer__title").css("font-size", "16px");
    }
    if (i === 1) {
      updateCartTitle("Your Cart Is Reserved for <span id='cartTimer'></span>");
    } else if (i === 2) {
      updateCartTitle("Todayâ€™s â€˜Flash Saleâ€™ Awaits You On The Next Page <span id='cartTimer'></span>");
    } else if (i === 3) {
      updateCartTitle("â€˜Flash Saleâ€™ Unlocked On Next Page <span id='cartTimer'></span>");
    } else if (i === 4) {
      updateCartTitle("Claim Your â€˜Flash Saleâ€™ Code On Next Page <span id='cartTimer'></span>");
    }
    updateCart('cartTime');
  }
}

if(window.location.href.includes("t1") || document.referrer.includes("t1")) {
  $(".product-disclaimer p").html("<strong>30 Day Money Back Guarantee!</strong> <br>Cancel subscriptions at anytime");
  $(".navigation-li a").each(function() {
    if ($(this).attr('href').includes("product")) {
      $(this).attr('href', $(this).attr('href') + '?view=t1');
    }
  });
}

function updateContentMarginTop() {
  var headerHeight = $(".header").height();
  $("body.has-promo").css("padding-top", 0)
  $(".content").css("margin-top", headerHeight);
}

updateContentMarginTop();

$(window).resize(function() {
  updateContentMarginTop();
});